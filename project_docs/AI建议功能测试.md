# AI 建议功能测试指南

## 功能概述

AI 建议功能已集成 DeepSeek AI，提供智能的、个性化的衣橱管理建议。

## 工作模式

### 1. DeepSeek AI 模式（优先）
- 调用 DeepSeek API 进行深度分析
- 考虑季节性、风格偏好、购买习惯
- 返回 3 条精准的个性化建议
- 包含详细的分析理由

### 2. 本地规则模式（降级）
- 当 API 调用失败时自动启用
- 基于预定义规则生成建议
- 8 个维度的综合分析
- 确保功能始终可用

## 测试步骤

### 1. 准备测试环境

确认环境变量已配置：
```bash
# .env.local
DEEPSEEK_API_KEY=""""""""
```

### 2. 启动开发服务器

```bash
cd ClientProject
npm run dev
```

### 3. 访问建议页面

打开浏览器访问：
```
http://localhost:3000/dashboard/recommendations
```

### 4. 检查控制台日志

在浏览器开发者工具的 Console 中查看：

**成功使用 DeepSeek：**
```
✅ 使用 DeepSeek AI 建议
AI 总结: [AI 生成的总结]
```

**降级到本地规则：**
```
DeepSeek API 调用失败，使用本地规则: [错误信息]
⚠️ 使用本地规则生成建议（降级方案）
```

### 5. 验证建议内容

#### AI 建议应包含：
- ✅ 恰好 3 条建议
- ✅ 简短标题（10字以内）
- ✅ 详细描述（30-50字）
- ✅ 分析理由（💡 开头）
- ✅ 优先级标签（高/中/低）
- ✅ 可操作按钮（如有）
- ✅ AI 模式指示卡片

#### 本地规则建议应包含：
- ✅ 多条建议（根据数据情况）
- ✅ 基于规则的分析
- ✅ 优先级排序

### 6. 测试不同场景

#### 场景 1：正常衣橱（30+ 件衣物）
**预期：**
- DeepSeek 分析成功
- 返回 3 条个性化建议
- 建议涵盖季节、风格、使用频率等

#### 场景 2：新衣橱（< 10 件衣物）
**预期：**
- 建议创建更多搭配
- 建议补充基础单品
- 优先级为中或低

#### 场景 3：API 失败（删除或修改 API Key）
**预期：**
- 自动降级到本地规则
- 控制台显示降级警告
- 功能正常可用

### 7. 测试交互功能

- [ ] 点击衣橱下拉菜单切换
- [ ] 点击"查看闲置衣物"等按钮跳转
- [ ] 下拉刷新页面
- [ ] 查看不同优先级的建议卡片

## 数据分析维度

### DeepSeek AI 分析（8 个维度，选择 3 个）
1. ⭐ 季节性分析（高优先级）
   - 当前季节衣物是否充足
   - 即将到来的季节准备

2. ⭐ 风格偏好匹配（高优先级）
   - 现有衣物是否符合用户风格
   - 推荐符合风格的搭配

3. ⭐ 购买习惯分析（中优先级）
   - 购买频率是否合理
   - 预算控制建议

4. 使用频率分析
5. 分类平衡性
6. 搭配组合优化
7. 品牌多样性
8. 整理与维护

### 本地规则分析（8 个维度，全部检查）
- 同样的 8 个维度
- 返回所有触发的建议

## 验收标准

### ✅ 功能完整性
- [x] DeepSeek API 集成完成
- [x] 本地规则降级方案可用
- [x] 数据准备函数正确
- [x] 类型定义完整

### ✅ 用户体验
- [x] 建议内容清晰易懂
- [x] 优先级标识明显
- [x] 可操作按钮有效
- [x] 加载状态友好
- [x] 空状态处理得当

### ✅ 性能优化
- [x] React Query 缓存（1 小时）
- [x] 并行数据查询
- [x] 错误处理完善
- [x] 降级方案无缝切换

### ✅ 代码质量
- [x] TypeScript 类型安全
- [x] 无 Lint 错误
- [x] 代码注释清晰
- [x] 函数职责单一

## 常见问题排查

### Q1: 建议一直是空的
**检查：**
1. 衣橱是否有衣物数据
2. wardrobeId 是否正确传递
3. 控制台是否有错误信息

### Q2: DeepSeek 一直失败
**检查：**
1. API Key 是否正确配置
2. 网络是否连接
3. API 配额是否用完
4. 查看控制台具体错误信息

### Q3: 建议质量不佳
**调整：**
1. 修改 temperature 参数（0.5-0.9）
2. 增加 maxTokens（2000-3000）
3. 完善用户偏好数据
4. 添加更多衣物标签信息

### Q4: 响应速度慢
**优化：**
1. 启用缓存（已默认开启 1 小时）
2. 减少输入数据量
3. 考虑使用流式 API

## 预期效果展示

### DeepSeek AI 建议示例

```
🤖 AI 智能分析模式
由 DeepSeek 提供支持，基于您的衣橱数据生成个性化建议

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🛍️ 准备春季外套 [高优先级]
春季即将到来，但您只有2件轻薄外套。建议购买1-2件春季夹克或风衣，适合早春穿搭。

💡 分析理由：当前季节为冬季，即将进入春季。数据显示您的春季外套数量不足，且您的购买频率较高，适合提前准备。

[浏览春季外套推荐]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 激活闲置运动装 [中优先级]
您有5件运动服超过30天未穿，与您的运动风格偏好不符。建议本周尝试搭配运动装出门。

💡 分析理由：用户风格偏好包含运动风，但运动类衣物利用率仅为35%，存在明显的使用与偏好不匹配。

[查看运动装建议]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🧹 控制购买频率 [低优先级]
您最近30天购买了5件衣物，购买频率较高。建议先充分利用现有衣物，暂缓新购。

💡 分析理由：购买频率为高频，但衣橱利用率仅为58.3%，说明现有衣物未被充分使用。
```

## 下一步优化建议

### Phase 1: 功能增强
- [ ] 添加用户反馈机制（👍/👎）
- [ ] 记录建议历史
- [ ] 建议执行追踪

### Phase 2: 个性化优化
- [ ] 允许用户自定义偏好
- [ ] 学习用户行为模式
- [ ] 动态调整建议策略

### Phase 3: 数据完善
- [ ] 添加天气数据集成
- [ ] 场合标签系统
- [ ] 穿搭日记功能

### Phase 4: 社交功能
- [ ] 建议分享
- [ ] 对比同类用户
- [ ] 优质建议推荐

---

**测试负责人**: AI Assistant  
**测试日期**: 2026-01-28  
**版本**: v1.0
