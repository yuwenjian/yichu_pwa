# DeepSeek AI Prompt 配置说明

## 核心 Prompt 设计

### 一、系统角色定义

```
你是一位专业的时尚衣橱管理顾问,擅长分析用户的衣物数据并提供个性化建议。
```

**角色特点:**
- 专业性：时尚顾问 + 数据分析师
- 专长领域：衣橱管理、穿搭建议、购买决策
- 输出风格：简洁、专业、基于数据

---

### 二、输入数据结构

#### 1. 基础信息
- 衣橱名称
- 衣物总数、搭配总数
- 总价值、平均价格
- 利用率（0-100%）

#### 2. 上下文信息（关键）
- **当前季节**：春/夏/秋/冬
- **即将到来的季节**：下一个季节
- **最近30天购买数量**：购买活跃度
- **购买频率**：高频/中频/低频

#### 3. 用户偏好（新增）
- **风格偏好**：休闲、正式、运动、复古等
- **喜欢的颜色**：白色、黑色、蓝色等
- **喜欢的品牌**：Uniqlo、Nike、MUJI等
- **预算水平**：低/中/高

#### 4. 衣物详情
每件衣物包含：
- 基础信息：名称、分类、品牌、价格
- 属性：颜色、尺码、季节
- 使用数据：购买时间、使用次数、最后穿搭时间
- 状态：正常/破损/丢失
- 标签：用户自定义标签

#### 5. 搭配详情
每个搭配包含：
- 名称、使用次数、最后使用时间
- 包含的衣物数量、标签

---

### 三、分析维度（8 个）

按重要性排序：

#### ⭐ 1. 季节性分析（高优先级）
- **触发条件**：
  - 当前季节衣物 < 15 件
  - 即将到来的季节衣物 < 10 件
  - 过季衣物占比 > 40%
- **输出建议**：
  - 当前季节缺什么类别
  - 下季度需要准备什么
  - 过季衣物整理提醒

#### ⭐ 2. 风格偏好匹配（高优先级）
- **触发条件**：
  - 用户偏好风格的衣物 < 30%
  - 存在与偏好不符的闲置衣物
  - 品牌/颜色与偏好偏离
- **输出建议**：
  - 推荐符合风格的搭配
  - 建议补充符合偏好的衣物
  - 提醒清理不符合风格的衣物

#### ⭐ 3. 购买习惯分析（中优先级）
- **触发条件**：
  - 购买频率 = 高 且 利用率 < 60%（过度购买）
  - 购买频率 = 低 且 衣物总数 < 20（需要补充）
  - 最近30天购买 > 5 件（冲动购买）
- **输出建议**：
  - 控制购买频率
  - 提升现有衣物利用率
  - 合理规划购买清单

#### 4. 使用频率分析（高优先级）
- **触发条件**：
  - 超过30天未穿的衣物 > 30%
  - 高价衣物（>¥500）使用次数 < 3
  - 整体利用率 < 50%
- **输出建议**：
  - 识别闲置衣物
  - 提升高价衣物使用率
  - 创建新搭配激活闲置衣物

#### 5. 分类平衡性（中优先级）
- **触发条件**：
  - 某一分类占比 > 40%（如全是上装）
  - 某一分类 < 5 件（如缺外套）
- **输出建议**：
  - 平衡各类别比例
  - 补充缺失的类别

#### 6. 搭配组合优化（中优先级）
- **触发条件**：
  - 搭配数量 < 5
  - 衣物数量 > 30 但搭配 < 10
- **输出建议**：
  - 创建更多搭配
  - 基于现有衣物推荐组合

#### 7. 品牌多样性（低优先级）
- **触发条件**：
  - 品牌数量 < 5
  - 某一品牌占比 > 50%
- **输出建议**：
  - 尝试新品牌
  - 推荐符合用户偏好的品牌

#### 8. 整理与维护（中优先级）
- **触发条件**：
  - 有破损状态的衣物
  - 有丢失状态的衣物
  - 超过60天未穿的衣物 > 20%
- **输出建议**：
  - 清理破损/丢失衣物
  - 定期整理衣橱

---

### 四、输出规范

#### 1. 建议数量
- **固定返回 3 条**（从 8 个维度中选择最重要的 3 个）

#### 2. 每条建议结构

```json
{
  "type": "shopping | style | organization | usage | outfit",
  "title": "简短标题（10字以内）",
  "description": "简短描述，30-50字，直接告诉用户该做什么",
  "priority": "high | medium | low",
  "reasoning": "为什么给出这个建议，基于哪些数据分析，30-50字",
  "actionable": {
    "action": "具体的行动建议",
    "relatedItems": ["相关衣物ID数组"]
  }
}
```

#### 3. 建议类型说明

| 类型 | 图标 | 说明 | 示例 |
|------|------|------|------|
| `shopping` | 🛍️ | 购物建议 | "准备春季外套" |
| `style` | 🎨 | 风格建议 | "尝试更多休闲风搭配" |
| `organization` | 🧹 | 整理建议 | "清理闲置衣物" |
| `usage` | 📊 | 使用建议 | "提升高价衣物利用率" |
| `outfit` | 👔 | 搭配建议 | "创建更多搭配组合" |

#### 4. 优先级说明

| 优先级 | 颜色 | 说明 | 示例场景 |
|--------|------|------|---------|
| `high` | 🔴 红色 | 需要立即关注 | 闲置严重、季节性缺失、高价衣物浪费 |
| `medium` | 🟡 黄色 | 建议尽快处理 | 分类不均衡、搭配不足、购买频率异常 |
| `low` | 🔵 蓝色 | 可选的优化 | 尝试新品牌、风格多样化 |

#### 5. 整体总结
- **长度**：50 字以内
- **内容**：概括用户衣橱的主要特点和核心建议

---

### 五、Prompt 策略

#### 1. 数据驱动
```
必须基于具体数据给出建议，不要泛泛而谈
示例：
❌ "建议多穿一些衣服"
✅ "您有12件上装超过30天未穿，占比27%，建议本周尝试搭配"
```

#### 2. 季节优先
```
优先考虑当前季节的实用性建议
示例：
当前季节=冬季 → 重点分析冬季衣物是否充足
即将到来=春季 → 提醒准备春季衣物
```

#### 3. 偏好匹配
```
结合用户的风格偏好和购买习惯给出建议
示例：
用户偏好=["休闲", "运动"]
→ 推荐休闲/运动风搭配
→ 识别不符合偏好的闲置衣物
```

#### 4. 可操作性
```
每条建议必须可操作、具体、有价值
示例：
❌ "优化衣橱管理"（太模糊）
✅ "清理5件破损衣物，释放10%空间"（具体可操作）
```

#### 5. 个性化
```
避免通用建议，基于用户的独特数据
示例：
❌ "建议创建更多搭配"（适用所有人）
✅ "您有45件衣物但只有8个搭配，建议创建3-5个常用搭配组合"（个性化）
```

---

### 六、质量控制

#### 1. 建议质量检查清单

- [ ] 基于具体数据（有数字、百分比）
- [ ] 简洁清晰（标题≤10字，描述≤50字）
- [ ] 可操作（有明确的行动建议）
- [ ] 个性化（不是通用建议）
- [ ] 优先级合理（基于问题严重程度）
- [ ] 季节相关（考虑当前和即将到来的季节）
- [ ] 符合偏好（匹配用户风格和预算）

#### 2. 示例对比

**低质量建议 ❌**
```json
{
  "title": "多穿衣服",
  "description": "您有很多衣服没穿，建议多穿一些。",
  "priority": "medium",
  "reasoning": "衣服很多没穿"
}
```

**高质量建议 ✅**
```json
{
  "title": "激活12件闲置上装",
  "description": "您有12件上装超过30天未穿（占比27%）。建议本周选择3件搭配新造型，提升利用率。",
  "priority": "high",
  "reasoning": "数据显示上装闲置率高达27%，且您的风格偏好为休闲风，这些上装均符合您的风格，适合激活使用。",
  "actionable": {
    "action": "查看闲置上装并创建搭配",
    "relatedItems": ["clothing-1", "clothing-5", "clothing-12"]
  }
}
```

---

### 七、温度参数调优

#### Temperature 对输出的影响

| Temperature | 特点 | 适用场景 |
|------------|------|---------|
| 0.3-0.5 | 保守、一致、数据驱动 | 需要稳定的分析结果 |
| 0.6-0.8 | 平衡、多样、有创意 | **推荐使用** |
| 0.9-1.0 | 创新、多变、风险高 | 需要非常规建议 |

**推荐配置**：`temperature = 0.7`

---

### 八、示例对话

#### 示例 1：闲置严重 + 季节缺失

**输入数据要点：**
- 总衣物: 50 件
- 利用率: 45%
- 当前季节: 冬季，冬装: 8 件
- 即将到来: 春季，春装: 5 件
- 闲置（>30天）: 22 件 (44%)

**期望输出：**

```json
{
  "recommendations": [
    {
      "type": "usage",
      "title": "激活22件闲置衣物",
      "description": "您有22件衣物超过30天未穿，占比44%。建议本周尝试搭配5件闲置衣物，提升整体利用率至55%以上。",
      "priority": "high",
      "reasoning": "闲置率高达44%，远超健康水平（30%）。这些衣物中多数符合您的休闲风格偏好，适合重新激活。"
    },
    {
      "type": "shopping",
      "title": "补充8件冬季衣物",
      "description": "当前冬季，您只有8件冬装（占比16%），低于推荐水平。建议补充2-3件冬季外套和5件保暖内搭。",
      "priority": "high",
      "reasoning": "当前季节为冬季，但冬装数量不足，与季节需求不匹配。您的预算水平为中等，适合购买实用冬装。"
    },
    {
      "type": "shopping",
      "title": "提前准备春季换装",
      "description": "春季即将到来，但您只有5件春装。建议提前购买3-5件轻薄外套和T恤，避免换季时匆忙购买。",
      "priority": "medium",
      "reasoning": "下季度为春季，但春装准备不足。根据您的购买习惯（中频），建议提前1个月规划春季衣物。"
    }
  ],
  "summary": "您的衣橱闲置率较高（44%），且季节性衣物不足。建议优先激活现有衣物，同时补充冬春两季衣物。"
}
```

#### 示例 2：购买过度 + 风格偏离

**输入数据要点：**
- 最近30天购买: 8 件
- 购买频率: 高频
- 利用率: 52%
- 风格偏好: ["休闲", "运动"]
- 正式风衣物: 15 件 (30%)，使用率: 20%

**期望输出：**

```json
{
  "recommendations": [
    {
      "type": "organization",
      "title": "暂停购买30天",
      "description": "您最近30天购买了8件衣物，购买频率过高。建议暂停购买，先充分利用现有50件衣物，提升利用率。",
      "priority": "high",
      "reasoning": "购买频率为高频，但衣橱利用率仅52%，说明新购衣物未被充分使用。暂停购买有助于控制预算和提升利用率。"
    },
    {
      "type": "style",
      "title": "清理15件正式风衣物",
      "description": "您有15件正式风衣物（占比30%），但与您的休闲/运动风格偏好不符，使用率仅20%。建议考虑转卖或捐赠。",
      "priority": "medium",
      "reasoning": "用户风格偏好为休闲和运动，但正式风衣物占比过高且使用率低，造成资源浪费。清理后可释放空间并明确风格方向。"
    },
    {
      "type": "outfit",
      "title": "创建5个运动休闲搭配",
      "description": "您有20件休闲/运动风衣物，但只有3个相关搭配。建议创建5个常用搭配，节省每日穿搭时间。",
      "priority": "medium",
      "reasoning": "您的核心风格为休闲/运动，但搭配数量不足。创建搭配可提升这些衣物的使用频率，同时简化穿搭决策。"
    }
  ],
  "summary": "您的购买频率过高且存在风格偏离。建议暂停购买，清理不符合偏好的衣物，并创建更多符合风格的搭配。"
}
```

---

### 九、调试技巧

#### 1. 查看原始 Prompt

```typescript
const prompt = generateDeepSeekPrompt(input)
console.log(prompt) // 检查 Prompt 是否正确
```

#### 2. 检查 API 响应

```typescript
const response = await fetch(DEEPSEEK_API_URL, { ... })
const data = await response.json()
console.log('Raw response:', data.choices[0].message.content)
```

#### 3. 验证解析结果

```typescript
const result = parseDeepSeekResponse(content)
if (!result) {
  console.error('Failed to parse response')
  console.error('Raw content:', content)
}
```

#### 4. 测试不同 Temperature

```typescript
// 测试多个温度值
for (const temp of [0.5, 0.7, 0.9]) {
  const result = await generateAIRecommendations(input, {
    apiKey,
    temperature: temp
  })
  console.log(`Temperature ${temp}:`, result)
}
```

---

**文档版本**: v1.0  
**创建日期**: 2026-01-28  
**最后更新**: 2026-01-28
